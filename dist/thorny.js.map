{"version":3,"file":"thorny.js","sources":["../src/lib/assertions.js","../src/run_controls.js","../src/print_controls.js","../src/lib/get_test_args.js","../node_modules/p-defer/index.js","../node_modules/delay/index.js","../src/lib/timeout.js","../src/lib/write_version.js","../src/runner.js","../src/index.js"],"sourcesContent":["function getError(message){\n    if(typeof Error !== 'undefined'){\n        return Error(message);\n    }else{\n        return message; //For really old browsers.\n    }\n}\n\nfunction createAssertError(message, info = {}, passed=true){\n    message = message ? '\\n' + message : '';\n\n    let assertData = Object.keys(info).reduce((data, prop)=>{\n        return data + '  ' + prop + ': ' + info[prop] + '\\n';\n    }, '');\n\n\n    message += '\\n  ---\\n' + assertData + '  ...\\n';\n\n\n    let e = new Error(message);\n    //console.log('PASSED ', passed);console.log(info);\n\n    e.passed = !!passed;\n    e.failed = !passed;\n    //console.log('e ', e)\n    return e;\n}\n\nexport default class Assertions {\n    assert(val, message, extra = {}){\n\n        if(!val){\n            let err = createAssertError(message, {\n                operator: 'assert',\n                expected: true,\n                actual: val\n            }, false);\n\n            throw err;\n        }\n    }\n    fail(message){\n        let err = createAssertError(message, {\n            operator: 'fail',\n        }, false);\n        throw err;\n    }\n    equal(value1, value2, message=''){\n        if(value1 !== value2){\n            let err = createAssertError(message, {\n                operator: 'equal',\n                expected: value1,\n                actual: value2\n            }, false);\n\n            throw err;\n        }\n    }\n    reject(message=''){\n        let err = createAssertError(message, {\n            operator: 'reject'\n        }, false);\n        return Promise.reject(err);\n    }\n}\n","import Assertions from './lib/assertions.js';\n\nexport default class RunControls {\n    constructor({\n        description = '',\n        count = 0,\n        read = null,\n        rethrow = false\n    } = {}){\n\n        let pending = Promise.resolve();\n        let rethrown = false;\n\n        Object.defineProperties(this, {\n            rethrow: {value: rethrow}\n        });\n\n        this.getResult = function(value, passed){\n\n            return {\n                description,\n                passed: !!passed,\n                failed: !passed,\n                value\n            };\n        };\n\n\n        this.write = function(result){\n            if(rethrown){ return this; }\n            if(rethrow){\n                rethrown = true;\n                pending = pending.then(v=>result).then(v=>{\n                    if(v.value && v.value instanceof Error){\n                        //let str = '\\n\\n  # rethrown test \\n'+v.value.message.split('\\n').join('\\n  ')+'\\n';\n                        //let err = new Error(str);\n                        return Promise.reject(\n                            new Error(\n                                '\\n\\n  # rethrown test \\n'+v.value.message.split('\\n').join('\\n  ')+'\\n'\n                            )\n                        );\n                    }\n                    return v;\n                });\n                return this;\n            }\n\n            pending = pending.then(v=>result).then(result=>{\n                return read(result);\n            });\n\n            return this;\n        };\n\n\n        this.end = function(){\n            return pending;\n        };\n    }\n    pass(value){\n        return this.getResult(value, true);\n    }\n    fail(value){\n        return this.getResult(value, false);\n    }\n    asserts(){\n        return new Assertions();\n    }\n    resolve(callback){\n        try{\n            return Promise.resolve(callback(this.asserts()))\n            .then(v=>this.pass(v))\n            .catch(e=>this.fail(e));\n        }catch(e){\n            return this.fail(e);\n        }\n    }\n    reverse(callback){\n        try{\n            return Promise.resolve(callback(this.asserts()))\n            .then(v=>this.fail(v))\n            .catch(e=>this.pass(e));\n        }catch(e){\n            return this.pass(e);\n        }\n    }\n}\n","export default class PrintControls {\n    constructor({\n        description,\n        result = {},\n        count = 0\n    } = {}){\n        Object.defineProperty(this, '_result', {\n            value: result\n        });\n        Object.defineProperty(this, 'count', {\n            value: count,\n            enumerable: true\n        });\n\n        this.tap = function(){\n            let t = this.result();\n\n            if(/^#/.test(t.description)){\n                const createDirective = (failed, result) =>{\n                    result.failed = failed;\n                    result.passed = !failed;\n                    result.value = new Error('');\n                    return result;\n                };\n                if(/^#[ ]TODO/.test(t.description)){\n                    t = createDirective(true, t);\n                }else if(/^#[ ]PASS/.test(t.description)){\n                    t = createDirective(false, t);\n                }\n            }\n\n            let message = t.description.length ? t.description : '';\n            let str = '';\n\n            if(t.passed){\n                str = 'ok ' + count + ' - ' + message;\n            }else if(t.failed){\n                let errMessage = t.value ? t.value.message : '';\n                str = 'not ok ' + count + ' - ' + message + ' ' + errMessage;\n            }\n            return str;\n        };\n    }\n    result(){\n        return this._result;\n    }\n}\n","export default function getTestArgs(description, options, callback){\n    if(typeof callback === 'undefined'){\n        if(typeof options === 'undefined'){\n            callback = description;\n            options = {};\n            description = '';\n        }else{\n            callback = options;\n        }\n    }\n    return [description, options, callback];\n}\n","'use strict';\nmodule.exports = () => {\n\tconst ret = {};\n\n\tret.promise = new Promise((resolve, reject) => {\n\t\tret.resolve = resolve;\n\t\tret.reject = reject;\n\t});\n\n\treturn ret;\n};\n","'use strict';\nconst defer = require('p-defer');\n\nclass CancelError extends Error {\n\tconstructor(message) {\n\t\tsuper(message);\n\t\tthis.name = 'CancelError';\n\t}\n}\n\nconst generate = willResolve => function (ms, value) {\n\tms = ms || 0;\n\tconst useValue = (arguments.length > 1);\n\tlet result = value;\n\n\tconst delaying = defer();\n\tconst promise = delaying.promise;\n\n\tlet timeout = setTimeout(() => {\n\t\tconst settle = willResolve ? delaying.resolve : delaying.reject;\n\t\tsettle(result);\n\t}, ms);\n\n\tconst thunk = thunkResult => {\n\t\tif (!useValue) {\n\t\t\tresult = thunkResult;\n\t\t}\n\t\treturn promise;\n\t};\n\n\tthunk.then = promise.then.bind(promise);\n\tthunk.catch = promise.catch.bind(promise);\n\tthunk._actualPromise = promise;\n\n\tthunk.cancel = () => {\n\t\tif (timeout) {\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = null;\n\t\t\tdelaying.reject(new CancelError('Delay canceled'));\n\t\t}\n\t};\n\n\treturn thunk;\n};\n\nmodule.exports = generate(true);\nmodule.exports.reject = generate(false);\nmodule.exports.CancelError = CancelError;\n","import delay from 'delay';\nexport default function timeout(n){\n    return delay(n);\n}\n","const writeVersion = (()=>{\n    let g;\n    let TAP_VERSION_WRITTEN = false;\n    if(typeof global === 'undefined'){\n        g = window;\n    }else{\n        g = global;\n    }\n\n    if(typeof g['TAP_VERSION_WRITTEN'] === 'undefined'){\n        Object.defineProperty(g, 'TAP_VERSION_WRITTEN', {\n            get(){\n                return TAP_VERSION_WRITTEN;\n            }\n        });\n    }\n\n    return ()=>{\n        if(g.TAP_VERSION_WRITTEN) return;\n        console.log('TAP version 13');\n        TAP_VERSION_WRITTEN = true;\n    };\n})();\n\nexport default writeVersion;\n","export function run(pattern, options, args){\n\n    if(typeof options === 'undefined'){\n        options = {};\n        args = [];\n    }else if(typeof args === 'undefined'){\n        if(Object.prototype.toString.call(options) === '[object Array]'){\n            args = options;\n            options = {};\n        }else{\n            args = [];\n        }\n    }\n\n    options.env = Object.assign(options.env || {}, {\n        TEST_ENVIRONMENT: true\n    });\n\n    try{\n\n        const glob = require('glob-promise');\n        const path = require('path');\n        const cwd = process.cwd();\n        //console.log('cwd ',cwd)\n        //console.log('options ',options)\n        return glob(pattern, options).then(files=>{\n            //console.log('files ',files)\n            return Promise.all(\n                files.map(file=>{\n                    return spawn(\n                        [file].concat(args),\n                        //[path.join(cwd, file)].concat(args),\n                        options\n                    );\n                })\n            );\n        });\n\n    }catch(e){\n        return Promise.reject(e);\n    }\n}\n\nfunction spawn(args=[], options = {}){\n    try{\n        const tapMerge = require('tap-merge');\n        const multistream = require('multistream');\n        const spawnCP = require('child_process').spawn;\n\n        const out = tapMerge();\n        //out.pipe(process.stdout);\n\n        options.stdio = [null, 'pipe', null];\n\n        return new Promise((resolve, reject)=>{\n            let cp = spawnCP('node', args, options);\n            cp.on('exit', resolve);\n            cp.on('error', reject);\n            //multistream([cp.stdout, cp.stderr]).pipe(out).pipe(process.stdout);\n            cp.stdout.pipe(out).pipe(process.stdout);\n            //cp.stderr.pipe(out).pipe(process.stderr);\n        });\n    }catch(e){\n        return Promise.reject(e);\n    }\n}\n","import RunControls from './run_controls.js';\nimport PrintControls from './print_controls.js';\nimport getTestArgs from './lib/get_test_args.js';\nimport timeout from './lib/timeout.js';\nimport writeVersion from './lib/write_version.js';\n\nexport * from './runner.js';\n\nexport class ThornyTest {\n    constructor({\n        description = '',\n        run = null,\n        print = null,\n        time = null,\n        count = 0,\n        rethrow = false\n    } = {}){\n        writeVersion();\n        let pending = timeout(1);\n        this['@@testinstance'] = true;\n        time = time || Date.now();\n\n        Object.defineProperties(this, {\n            count: {get(){ return count; }},\n            startTime: {value: time},\n            rethrow: {value: rethrow}\n        });\n\n        let running;\n\n        if(run){\n\n            running = new RunControls({\n                description,\n                rethrow,\n                read(result){\n                    return print(new PrintControls({result, count}));\n                }\n            });\n\n            //pending = pending.then(v=>run(running));\n\n        }\n\n        let included = [];\n\n        Object.defineProperty(this, 'include', {\n            value: function(...plans){\n                included = included.concat(plans);\n            }\n        });\n\n        Object.defineProperty(this, 'done', {\n            value: function(callback, keepTesting){\n\n                if(included.length){\n                    pending = included.reduce((p, plan)=>{\n                        return p.then(v=>plan.done());\n                    }, Promise.resolve());\n                }\n\n                if(run){\n                    pending = pending.then(v=>run(running));\n                    return pending\n                    .then(v=>{\n                        if(!keepTesting && !rethrow){\n                            console.log('1..' + count);\n                            console.log('# duration ' + (Date.now()-time) + 'ms');\n                        }\n                        try{\n                            if(callback){\n                                return callback(v);\n                            }\n                            return pending.then(a=>v);\n                        }catch(e){\n                            return Promise.reject(e);\n                        }\n\n                    });\n                }\n\n                if(callback){\n                    return Promise.resolve().then(callback);\n                }\n\n                return Promise.resolve();\n            }\n        });\n    }\n    test(description, options, callback){\n        let self = this;\n\n        [description, options, callback] = getTestArgs(description, options, callback);\n\n        return new (this.constructor)({\n            description,\n            time: this.startTime,\n            count: this.count + 1,\n            rethrow: options.rethrow,\n            print(complete){\n                let output = complete.tap();\n                console.log(output);\n            },\n            run(controls){\n                return self.done(()=>{\n                    let result = controls.resolve(callback);\n                    return controls.write(result).end();\n                }, true);\n            }\n        });\n    }\n    reverse(description, options, callback){\n        let self = this;\n\n        [description, options, callback] = getTestArgs(description, options, callback);\n\n        return new (this.constructor)({\n            description,\n            time: this.startTime,\n            count: this.count + 1,\n            rethrow: options.rethrow,\n            print(complete){\n                let output = complete.tap();\n                console.log(output);\n            },\n            run(controls){\n                return self.done(()=>{\n                    let result = controls.reverse(callback);\n                    return controls.write(result).end();\n                }, true);\n            }\n        });\n    }\n}\n\nexport function thorny(options = {}){\n    return new ThornyTest(options);\n}\n"],"names":["let","this","const","super","defer","delay"],"mappings":";;;AAQA,SAAS,iBAAiB,CAAC,OAAO,EAAE,IAAS,EAAE,MAAW,CAAC;+BAAnB,GAAG,EAAE,CAAQ;mCAAA,CAAC,IAAI;;IACtD,OAAO,GAAG,OAAO,GAAG,IAAI,GAAG,OAAO,GAAG,EAAE,CAAC;;IAExCA,IAAI,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,UAAC,IAAI,EAAE,IAAI,CAAC;QAClD,OAAO,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC;KACxD,EAAE,EAAE,CAAC,CAAC;;;IAGP,OAAO,IAAI,WAAW,GAAG,UAAU,GAAG,SAAS,CAAC;;;IAGhDA,IAAI,CAAC,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;;;IAG3B,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,MAAM,CAAC;IACpB,CAAC,CAAC,MAAM,GAAG,CAAC,MAAM,CAAC;;IAEnB,OAAO,CAAC,CAAC;CACZ;;AAED,IAAqB,UAAU,GAAC;;AAAA,qBAC5B,MAAM,oBAAC,GAAG,EAAE,OAAO,EAAE,KAAU,CAAC;qCAAN,GAAG,EAAE;;;IAE/B,GAAO,CAAC,GAAG,CAAC;QACR,IAAQ,GAAG,GAAG,iBAAiB,CAAC,OAAO,EAAE;YACrC,QAAY,EAAE,QAAQ;YACtB,QAAY,EAAE,IAAI;YAClB,MAAU,EAAE,GAAG;SACd,EAAE,KAAK,CAAC,CAAC;;QAEd,MAAU,GAAG,CAAC;KACb;CACJ,CAAA;AACL,qBAAI,IAAI,kBAAC,OAAO,CAAC;IACb,IAAQ,GAAG,GAAG,iBAAiB,CAAC,OAAO,EAAE;QACrC,QAAY,EAAE,MAAM;KACnB,EAAE,KAAK,CAAC,CAAC;IACd,MAAU,GAAG,CAAC;CACb,CAAA;AACL,qBAAI,KAAK,mBAAC,MAAM,EAAE,MAAM,EAAE,OAAU,CAAC;yCAAJ,CAAC,EAAE;;IAChC,GAAO,MAAM,KAAK,MAAM,CAAC;QACrB,IAAQ,GAAG,GAAG,iBAAiB,CAAC,OAAO,EAAE;YACrC,QAAY,EAAE,OAAO;YACrB,QAAY,EAAE,MAAM;YACpB,MAAU,EAAE,MAAM;SACjB,EAAE,KAAK,CAAC,CAAC;;QAEd,MAAU,GAAG,CAAC;KACb;CACJ,CAAA;AACL,qBAAI,MAAM,oBAAC,OAAU,CAAC;yCAAJ,CAAC,EAAE;;IACjB,IAAQ,GAAG,GAAG,iBAAiB,CAAC,OAAO,EAAE;QACrC,QAAY,EAAE,QAAQ;KACrB,EAAE,KAAK,CAAC,CAAC;IACd,OAAW,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;CAC9B,CAAA;;AC7DL,IAAqB,WAAW,GAAC,oBAClB,CAAC,GAAA,CAKL;6BAAN,GAAG,EAAE,CAJY;mFAAA,EAAE,CACR;2DAAA,CAAC,CACF;uDAAA,IAAI,CACD;mEAAA,KAAK;;;IAGnB,IAAQ,OAAO,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;IACpC,IAAQ,QAAQ,GAAG,KAAK,CAAC;;IAEzB,MAAU,CAAC,gBAAgB,CAAC,IAAI,EAAE;QAC9B,OAAW,EAAE,CAAC,KAAK,EAAE,OAAO,CAAC;KAC5B,CAAC,CAAC;;IAEP,IAAQ,CAAC,SAAS,GAAG,SAAS,KAAK,EAAE,MAAM,CAAC;;QAExC,OAAW;YACP,aAAI,WAAW;YACf,MAAU,EAAE,CAAC,CAAC,MAAM;YACpB,MAAU,EAAE,CAAC,MAAM;YACnB,OAAI,KAAK;SACR,CAAC;KACL,CAAC;;;IAGN,IAAQ,CAAC,KAAK,GAAG,SAAS,MAAM,CAAC;QAC7B,GAAO,QAAQ,CAAC,EAAE,OAAO,IAAI,CAAC,EAAE;QAChC,GAAO,OAAO,CAAC;YACX,QAAY,GAAG,IAAI,CAAC;YACpB,OAAW,GAAG,OAAO,CAAC,IAAI,CAAC,UAAA,CAAC,CAAA,SAAE,MAAM,GAAA,CAAC,CAAC,IAAI,CAAC,UAAA,CAAC,CAAA;gBACxC,GAAO,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,KAAK,YAAY,KAAK,CAAC;;;oBAGvC,OAAW,OAAO,CAAC,MAAM;wBACrB,IAAQ,KAAK;4BACT,0BAA8B,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI;yBAC3E;qBACJ,CAAC;iBACL;gBACL,OAAW,CAAC,CAAC;aACZ,CAAC,CAAC;YACP,OAAW,IAAI,CAAC;SACf;;QAEL,OAAW,GAAG,OAAO,CAAC,IAAI,CAAC,UAAA,CAAC,CAAA,SAAE,MAAM,GAAA,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM,CAAA;YAC7C,OAAW,IAAI,CAAC,MAAM,CAAC,CAAC;SACvB,CAAC,CAAC;;QAEP,OAAW,IAAI,CAAC;KACf,CAAC;;;IAGN,IAAQ,CAAC,GAAG,GAAG,UAAU;QACrB,OAAW,OAAO,CAAC;KAClB,CAAC;CACL,CAAA;AACL,sBAAI,IAAI,kBAAC,KAAK,CAAC;IACX,OAAW,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;CACtC,CAAA;AACL,sBAAI,IAAI,kBAAC,KAAK,CAAC;IACX,OAAW,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;CACvC,CAAA;AACL,sBAAI,OAAO,sBAAE;IACT,OAAW,IAAI,UAAU,EAAE,CAAC;CAC3B,CAAA;AACL,sBAAI,OAAO,qBAAC,QAAQ,CAAC;;;IACjB,GAAO;QACH,OAAW,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;SAC/C,IAAI,CAAC,UAAA,CAAC,CAAA,SAAEC,MAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAA,CAAC;SACrB,KAAK,CAAC,UAAA,CAAC,CAAA,SAAEA,MAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAA,CAAC,CAAC;KAC3B,MAAM,CAAC,CAAC;QACT,OAAW,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACvB;CACJ,CAAA;AACL,sBAAI,OAAO,qBAAC,QAAQ,CAAC;;;IACjB,GAAO;QACH,OAAW,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;SAC/C,IAAI,CAAC,UAAA,CAAC,CAAA,SAAEA,MAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAA,CAAC;SACrB,KAAK,CAAC,UAAA,CAAC,CAAA,SAAEA,MAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAA,CAAC,CAAC;KAC3B,MAAM,CAAC,CAAC;QACT,OAAW,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACvB;CACJ,CAAA;;ACrFU,IAAM,aAAa,GAAC,sBACpB,CAAC,GAAA,CAIL;6BAAN,GAAG,EAAE,CAHF;QAAA,WAAW,mBACF;+DAAA,EAAE,CACH;2DAAA,CAAC;;IAEb,MAAU,CAAC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE;QACvC,KAAS,EAAE,MAAM;KAChB,CAAC,CAAC;IACP,MAAU,CAAC,cAAc,CAAC,IAAI,EAAE,OAAO,EAAE;QACrC,KAAS,EAAE,KAAK;QAChB,UAAc,EAAE,IAAI;KACnB,CAAC,CAAC;;IAEP,IAAQ,CAAC,GAAG,GAAG,UAAU;QACrB,IAAQ,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC;;QAE1B,GAAO,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;YAC5B,IAAU,eAAe,GAAG,UAAC,MAAM,EAAE,MAAM,EAAE;gBACzC,MAAU,CAAC,MAAM,GAAG,MAAM,CAAC;gBAC3B,MAAU,CAAC,MAAM,GAAG,CAAC,MAAM,CAAC;gBAC5B,MAAU,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,EAAE,CAAC,CAAC;gBACjC,OAAW,MAAM,CAAC;aACjB,CAAC;YACN,GAAO,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;gBACnC,CAAK,GAAG,eAAe,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;aAChC,KAAK,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;gBACzC,CAAK,GAAG,eAAe,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;aACjC;SACJ;;QAEL,IAAQ,OAAO,GAAG,CAAC,CAAC,WAAW,CAAC,MAAM,GAAG,CAAC,CAAC,WAAW,GAAG,EAAE,CAAC;QAC5D,IAAQ,GAAG,GAAG,EAAE,CAAC;;QAEjB,GAAO,CAAC,CAAC,MAAM,CAAC;YACZ,GAAO,GAAG,KAAK,GAAG,KAAK,GAAG,KAAK,GAAG,OAAO,CAAC;SACzC,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC;YAClB,IAAQ,UAAU,GAAG,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,OAAO,GAAG,EAAE,CAAC;YACpD,GAAO,GAAG,SAAS,GAAG,KAAK,GAAG,KAAK,GAAG,OAAO,GAAG,GAAG,GAAG,UAAU,CAAC;SAChE;QACL,OAAW,GAAG,CAAC;KACd,CAAC;CACL,CAAA;AACL,wBAAI,MAAM,qBAAE;IACR,OAAW,IAAI,CAAC,OAAO,CAAC;CACvB,CAAA;;AC7CU,SAAS,WAAW,CAAC,WAAW,EAAE,OAAO,EAAE,QAAQ,CAAC;IAC/D,GAAG,OAAO,QAAQ,KAAK,WAAW,CAAC;QAC/B,GAAG,OAAO,OAAO,KAAK,WAAW,CAAC;YAC9B,QAAQ,GAAG,WAAW,CAAC;YACvB,OAAO,GAAG,EAAE,CAAC;YACb,WAAW,GAAG,EAAE,CAAC;SACpB,IAAI;YACD,QAAQ,GAAG,OAAO,CAAC;SACtB;KACJ;IACD,OAAO,CAAC,WAAW,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC;CAC3C;;ACVD,WAAc,GAAG;CAChBC,IAAM,GAAG,GAAG,EAAE,CAAC;;CAEf,GAAG,CAAC,OAAO,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;EACzC,GAAG,CAAC,OAAO,GAAG,OAAO,CAAC;EACtB,GAAG,CAAC,MAAM,GAAG,MAAM,CAAC;EACpB,CAAC,CAAC;;CAEH,OAAO,GAAG,CAAC;CACX;;ACPD,IAAM,WAAW;CAAe,oBACpB,CAAC,OAAO,EAAE;EACpBC,KAAK,KAAA,CAAC,MAAA,OAAO,CAAC,CAAC;EACf,IAAI,CAAC,IAAI,GAAG,aAAa,CAAC;EAC1B;;;;iDAAA;;;EAJwB,KAKzB,GAAA;;AAEDD,IAAM,QAAQ,GAAG,UAAA,WAAW,WAAI,UAAU,EAAE,EAAE,KAAK,EAAE;CACpD,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;CACbA,IAAM,QAAQ,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;CACxCF,IAAI,MAAM,GAAG,KAAK,CAAC;;CAEnBE,IAAM,QAAQ,GAAGE,OAAK,EAAE,CAAC;CACzBF,IAAM,OAAO,GAAG,QAAQ,CAAC,OAAO,CAAC;;CAEjCF,IAAI,OAAO,GAAG,UAAU,CAAC;EACxBE,IAAM,MAAM,GAAG,WAAW,GAAG,QAAQ,CAAC,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC;EAChE,MAAM,CAAC,MAAM,CAAC,CAAC;EACf,EAAE,EAAE,CAAC,CAAC;;CAEPA,IAAM,KAAK,GAAG,UAAA,WAAW;EACxB,IAAI,CAAC,QAAQ,EAAE;GACd,MAAM,GAAG,WAAW,CAAC;GACrB;EACD,OAAO,OAAO,CAAC;EACf,CAAC;;CAEF,KAAK,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;CACxC,KAAK,CAAC,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;CAC1C,KAAK,CAAC,cAAc,GAAG,OAAO,CAAC;;CAE/B,KAAK,CAAC,MAAM,GAAG;EACd,IAAI,OAAO,EAAE;GACZ,YAAY,CAAC,OAAO,CAAC,CAAC;GACtB,OAAO,GAAG,IAAI,CAAC;GACf,QAAQ,CAAC,MAAM,CAAC,IAAI,WAAW,CAAC,gBAAgB,CAAC,CAAC,CAAC;GACnD;EACD,CAAC;;CAEF,OAAO,KAAK,CAAC;CACb,GAAA,CAAC;;AAEF,SAAc,GAAG,QAAQ,CAAC,IAAI,CAAC,CAAC;AAChC,UAAqB,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;AACxC,iBAA0B,GAAG,WAAW,CAAC;;;;;AC9C1B,SAAS,OAAO,CAAC,CAAC,CAAC;IAC9B,OAAOG,KAAK,CAAC,CAAC,CAAC,CAAC;CACnB;;ACHDH,IAAM,YAAY,GAAG,CAAC,WAAE;IACpBF,IAAI,CAAC,CAAC;IACNA,IAAI,mBAAmB,GAAG,KAAK,CAAC;IAChC,GAAG,OAAO,MAAM,KAAK,WAAW,CAAC;QAC7B,CAAC,GAAG,MAAM,CAAC;KACd,IAAI;QACD,CAAC,GAAG,MAAM,CAAC;KACd;;IAED,GAAG,OAAO,CAAC,CAAC,qBAAqB,CAAC,KAAK,WAAW,CAAC;QAC/C,MAAM,CAAC,cAAc,CAAC,CAAC,EAAE,qBAAqB,EAAE;YAC5C,GAAG,cAAA,EAAE;gBACD,OAAO,mBAAmB,CAAC;aAC9B;SACJ,CAAC,CAAC;KACN;;IAED,OAAO,WAAE;QACL,GAAG,CAAC,CAAC,mBAAmB,EAAE,EAAA,OAAO,EAAA;QACjC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;QAC9B,mBAAmB,GAAG,IAAI,CAAC;KAC9B,CAAC;CACL,GAAG;;ACtBG,SAAS,GAAG,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC;;IAEvC,GAAG,OAAO,OAAO,KAAK,WAAW,CAAC;QAC9B,OAAO,GAAG,EAAE,CAAC;QACb,IAAI,GAAG,EAAE,CAAC;KACb,KAAK,GAAG,OAAO,IAAI,KAAK,WAAW,CAAC;QACjC,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,gBAAgB,CAAC;YAC5D,IAAI,GAAG,OAAO,CAAC;YACf,OAAO,GAAG,EAAE,CAAC;SAChB,IAAI;YACD,IAAI,GAAG,EAAE,CAAC;SACb;KACJ;;IAED,OAAO,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,IAAI,EAAE,EAAE;QAC3C,gBAAgB,EAAE,IAAI;KACzB,CAAC,CAAC;;IAEH,GAAG;;QAECE,IAAM,IAAI,GAAG,OAAO,CAAC,cAAc,CAAC,CAAC;QACrCA,IAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;QAC7BA,IAAM,GAAG,GAAG,OAAO,CAAC,GAAG,EAAE,CAAC;;;QAG1B,OAAO,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,IAAI,CAAC,UAAA,KAAK,CAAA;;YAEpC,OAAO,OAAO,CAAC,GAAG;gBACd,KAAK,CAAC,GAAG,CAAC,UAAA,IAAI,CAAA;oBACV,OAAO,KAAK;wBACR,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC;;wBAEnB,OAAO;qBACV,CAAC;iBACL,CAAC;aACL,CAAC;SACL,CAAC,CAAC;;KAEN,MAAM,CAAC,CAAC;QACL,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;KAC5B;CACJ;;AAED,SAAS,KAAK,CAAC,IAAO,EAAE,OAAY,CAAC;+BAAlB,CAAC,EAAE,CAAS;qCAAA,GAAG,EAAE;;IAChC,GAAG;QACCA,IAAM,QAAQ,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;QACtCA,IAAM,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;QAC3CA,IAAM,OAAO,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC,KAAK,CAAC;;QAE/CA,IAAM,GAAG,GAAG,QAAQ,EAAE,CAAC;;;QAGvB,OAAO,CAAC,KAAK,GAAG,CAAC,IAAI,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;;QAErC,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,CAAC;YAChCF,IAAI,EAAE,GAAG,OAAO,CAAC,MAAM,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YACxC,EAAE,CAAC,EAAE,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;YACvB,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;;YAEvB,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;;SAE5C,CAAC,CAAC;KACN,MAAM,CAAC,CAAC;QACL,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;KAC5B;CACJ;;ACzDM,IAAM,UAAU,GAAC,mBACT,CAAC,GAAA,CAOL;6BAAN,GAAG,EAAE,CANY;mFAAA,EAAE,CACV;mDAAA,IAAI,CACF;2DAAA,IAAI,CACL;uDAAA,IAAI,CACH;2DAAA,CAAC,CACC;mEAAA,KAAK;;IAEnB,YAAgB,EAAE,CAAC;IACnB,IAAQ,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;IAC7B,IAAQ,CAAC,gBAAgB,CAAC,GAAG,IAAI,CAAC;IAClC,IAAQ,GAAG,IAAI,IAAI,IAAI,CAAC,GAAG,EAAE,CAAC;;IAE9B,MAAU,CAAC,gBAAgB,CAAC,IAAI,EAAE;QAC9B,KAAS,EAAE,CAAC,GAAG,cAAA,EAAE,EAAE,OAAO,KAAK,CAAC,EAAE,CAAC;QACnC,SAAa,EAAE,CAAC,KAAK,EAAE,IAAI,CAAC;QAC5B,OAAW,EAAE,CAAC,KAAK,EAAE,OAAO,CAAC;KAC5B,CAAC,CAAC;;IAEP,IAAQ,OAAO,CAAC;;IAEhB,GAAO,GAAG,CAAC;;QAEP,OAAW,GAAG,IAAI,WAAW,CAAC;YAC1B,aAAI,WAAW;YACf,SAAI,OAAO;YACX,IAAQ,eAAA,CAAC,MAAM,CAAC;gBACZ,OAAW,KAAK,CAAC,IAAI,aAAa,CAAC,CAAC,QAAA,MAAM,EAAE,OAAA,KAAK,CAAC,CAAC,CAAC,CAAC;aACpD;SACJ,CAAC,CAAC;;;;KAIN;;IAEL,IAAQ,QAAQ,GAAG,EAAE,CAAC;;IAEtB,MAAU,CAAC,cAAc,CAAC,IAAI,EAAE,SAAS,EAAE;QACvC,KAAS,EAAE,UAAkB;;;;YACzB,QAAY,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;SACrC;KACJ,CAAC,CAAC;;IAEP,MAAU,CAAC,cAAc,CAAC,IAAI,EAAE,MAAM,EAAE;QACpC,KAAS,EAAE,SAAS,QAAQ,EAAE,WAAW,CAAC;;YAEtC,GAAO,QAAQ,CAAC,MAAM,CAAC;gBACnB,OAAW,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAC,CAAC,EAAE,IAAI,CAAC;oBACnC,OAAW,CAAC,CAAC,IAAI,CAAC,UAAA,CAAC,CAAA,SAAE,IAAI,CAAC,IAAI,EAAE,GAAA,CAAC,CAAC;iBACjC,EAAE,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC;aACzB;;YAEL,GAAO,GAAG,CAAC;gBACP,OAAW,GAAG,OAAO,CAAC,IAAI,CAAC,UAAA,CAAC,CAAA,SAAE,GAAG,CAAC,OAAO,CAAC,GAAA,CAAC,CAAC;gBAC5C,OAAW,OAAO;iBACb,IAAI,CAAC,UAAA,CAAC,CAAA;oBACP,GAAO,CAAC,WAAW,IAAI,CAAC,OAAO,CAAC;wBAC5B,OAAW,CAAC,GAAG,CAAC,KAAK,GAAG,KAAK,CAAC,CAAC;wBAC/B,OAAW,CAAC,GAAG,CAAC,aAAa,IAAI,IAAI,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAC;qBACzD;oBACL,GAAO;wBACH,GAAO,QAAQ,CAAC;4BACZ,OAAW,QAAQ,CAAC,CAAC,CAAC,CAAC;yBACtB;wBACL,OAAW,OAAO,CAAC,IAAI,CAAC,UAAA,CAAC,CAAA,SAAE,CAAC,GAAA,CAAC,CAAC;qBAC7B,MAAM,CAAC,CAAC;wBACT,OAAW,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;qBAC5B;;iBAEJ,CAAC,CAAC;aACN;;YAEL,GAAO,QAAQ,CAAC;gBACZ,OAAW,OAAO,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;aAC3C;;YAEL,OAAW,OAAO,CAAC,OAAO,EAAE,CAAC;SAC5B;KACJ,CAAC,CAAC;CACN,CAAA;AACL,qBAAI,IAAI,kBAAC,WAAW,EAAE,OAAO,EAAE,QAAQ,CAAC;IACpC,IAAQ,IAAI,GAAG,IAAI,CAAC;;IAEpB;QAAuC,UAAA,WAAW,CAAC,WAAW,EAAE,OAAO,EAAE,QAAQ,CAA5E,EAAA,WAAa,cAAA,OAAS,cAAA,QAAvB,cAA+E;;IAEnF,OAAW,KAAK,IAAI,CAAC,WAAW,EAAE;QAC9B,aAAI,WAAW;QACf,IAAQ,EAAE,IAAI,CAAC,SAAS;QACxB,KAAS,EAAE,IAAI,CAAC,KAAK,GAAG,CAAC;QACzB,OAAW,EAAE,OAAO,CAAC,OAAO;QAC5B,KAAS,gBAAA,CAAC,QAAQ,CAAC;YACf,IAAQ,MAAM,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;YAChC,OAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;SACvB;QACL,GAAO,cAAA,CAAC,QAAQ,CAAC;YACb,OAAW,IAAI,CAAC,IAAI,CAAC,WAAE;gBACnB,IAAQ,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC5C,OAAW,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC;aACvC,EAAE,IAAI,CAAC,CAAC;SACZ;KACJ,CAAC,CAAC;CACN,CAAA;AACL,qBAAI,OAAO,qBAAC,WAAW,EAAE,OAAO,EAAE,QAAQ,CAAC;IACvC,IAAQ,IAAI,GAAG,IAAI,CAAC;;IAEpB;QAAuC,UAAA,WAAW,CAAC,WAAW,EAAE,OAAO,EAAE,QAAQ,CAA5E,EAAA,WAAa,cAAA,OAAS,cAAA,QAAvB,cAA+E;;IAEnF,OAAW,KAAK,IAAI,CAAC,WAAW,EAAE;QAC9B,aAAI,WAAW;QACf,IAAQ,EAAE,IAAI,CAAC,SAAS;QACxB,KAAS,EAAE,IAAI,CAAC,KAAK,GAAG,CAAC;QACzB,OAAW,EAAE,OAAO,CAAC,OAAO;QAC5B,KAAS,gBAAA,CAAC,QAAQ,CAAC;YACf,IAAQ,MAAM,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC;YAChC,OAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;SACvB;QACL,GAAO,cAAA,CAAC,QAAQ,CAAC;YACb,OAAW,IAAI,CAAC,IAAI,CAAC,WAAE;gBACnB,IAAQ,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;gBAC5C,OAAW,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,CAAC;aACvC,EAAE,IAAI,CAAC,CAAC;SACZ;KACJ,CAAC,CAAC;CACN,CAAA;;AAGL,AAAO,SAAS,MAAM,CAAC,OAAY,CAAC;qCAAN,GAAG,EAAE;;IAC/B,OAAO,IAAI,UAAU,CAAC,OAAO,CAAC,CAAC;CAClC;;;;;;;;;;"}